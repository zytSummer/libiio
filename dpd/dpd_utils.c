
#include "math_utils.h"
#include "dpd_utils.h"

#include <string.h>

static const double allLegendreCoeffs[15][15] = {
    {        1,          0,         0,           0,          0,           0,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {        2,         -1,         0,           0,          0,           0,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {        6,         -6,         1,           0,          0,           0,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {       20,        -30,        12,          -1,          0,           0,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {       70,       -140,        90,         -20,          1,           0,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {      252,       -630,       560,        -210,         30,          -1,         0,          0,         0,         0,       0,       0,     0,    0, 0 },
    {      924,      -2772,      3150,       -1680,        420,         -42,         1,          0,         0,         0,       0,       0,     0,    0, 0 },
    {     3432,     -12012,     16632,      -11550,       4200,        -756,        56,         -1,         0,         0,       0,       0,     0,    0, 0 },
    {    12870,     -51480,     84084,      -72072,      34650,       -9240,      1260,        -72,         1,         0,       0,       0,     0,    0, 0 },
    {    48620,    -218790,    411840,     -420420,     252252,      -90090,     18480,      -1980,        90,        -1,       0,       0,     0,    0, 0 },
    {   184756,    -923780,   1969110,    -2333760,    1681680,     -756756,    210210,     -34320,      2970,      -110,       1,       0,     0,    0, 0 },
    {   705432,   -3879876,   9237800,   -12471030,   10501920,    -5717712,   2018016,    -450450,     60060,     -4290,     132,      -1,     0,    0, 0 },
    {  2704156,  -16224936,  42678636,   -64664600,   62355150,   -39907296,  17153136,   -4900896,    900900,   -100100,    6006,    -156,     1,    0, 0 },
    { 10400600,  -67603900, 194699232,  -327202876,  355655300,  -261891630, 133024320,  -46558512,  11027016,  -1701700,  160160,   -8190,   182,   -1, 0 },
    { 40116600, -280816200, 878850700, -1622493600, 1963217256, -1636014380, 960269310, -399072960, 116396280, -23279256, 3063060, -247520, 10920, -210, 1 },
};

void dpd_UtilGetBlockFeatureMaskIndex(uint8_t fIndex, uint8_t *pBlkIdx, uint8_t *pBlkFeatIdx)
{
    *pBlkIdx     = fIndex / 64u;
    *pBlkFeatIdx = fIndex % 64u;
}

double dpd_UtilShiftedLegendre(double x, uint32_t n)
{
    double   polyval;
    uint32_t m;
    polyval = allLegendreCoeffs[n][0];
    for (m = 1u; m < (n + 1u); m++)
    {
        polyval = allLegendreCoeffs[n][m] + x * polyval;
    }
    return (polyval);
}